START TRANSACTION;
SELECT
	`spm_problems`.`difficulty`,

	`spm_problems`.`authorSolution`,
	`spm_problems`.`authorSolutionLanguage`,

	`spm_problems`.`adaptProgramOutput`,

	`spm_submissions`.`submissionId`,

	`spm_submissions`.`olympId`,

	`spm_submissions`.`time`,

	`spm_submissions`.`userId`,
	`spm_submissions`.`problemId`,

	`spm_submissions`.`testType`,
	`spm_submissions`.`judge`,
	`spm_submissions`.`customTest`,

	`spm_submissions`.`codeLang`,
	`spm_submissions`.`problemCode`
FROM
	`spm_submissions`
INNER JOIN
	`spm_problems`
ON
	spm_submissions.problemId = spm_problems.id
WHERE
	`status` = 'waiting'
AND
	`codeLang` IN (@EnabledLanguages)
AND
	`authorSolutionLanguage` IN (@EnabledLanguages)
ORDER BY
	`submissionId` ASC,
	`time` ASC
LIMIT
	1
FOR UPDATE;